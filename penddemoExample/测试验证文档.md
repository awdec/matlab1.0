# 测试验证文档

## 测试概述

本文档定义了一阶倒立摆控制系统的完整测试方案，包括功能测试、性能验证、边界测试和鲁棒性测试。

## 测试环境

### 软件环境

- MATLAB版本：R2019a或更高
- Simulink工具箱
- Control System Toolbox
- 操作系统：Windows 10/11, Linux, macOS

### 测试准备

1. 确保所有项目文件完整：
   - penddemo.slx
   - pendan.m
   - penddemoExample.m
   - pendulum1.png

2. 清空工作区变量：
```matlab
clear; clc; close all;
```

3. 添加路径：
```matlab
addpath('penddemoExample');
```

## 功能测试用例

### TC-01: 模型加载测试

**测试目标**：验证模型文件能正常打开且无错误

**前置条件**：MATLAB已启动，路径设置正确

**测试步骤**：
1. 运行命令：`penddemoExample`
2. 观察命令窗口输出
3. 检查Simulink模型窗口是否打开

**预期结果**：
- 模型文件成功打开
- 无错误或警告信息
- 模型显示正常

**测试数据**：无

**实际结果**：

| 测试日期 | 测试人 | 结果 | 备注 |
|---------|--------|------|------|
|         |        |      |      |

---

### TC-02: 动画窗口初始化测试

**测试目标**：验证动画窗口能正确创建并显示初始状态

**前置条件**：模型已打开

**测试步骤**：
1. 启动仿真
2. 观察动画窗口是否出现
3. 检查初始状态显示

**预期结果**：
- 动画窗口正常弹出
- 标题为"Pendulum Animation"
- 小车位于中心位置（x=0）
- 摆杆竖直向上（θ=0）
- 时间显示为0
- 滑块位于参考位置
- "Playback"按钮初始为禁用状态

**实际结果**：

| 测试日期 | 测试人 | 结果 | 备注 |
|---------|--------|------|------|
|         |        |      |      |

---

### TC-03: 平衡控制测试

**测试目标**：验证系统能将摆杆稳定在竖直位置

**前置条件**：仿真已启动

**测试步骤**：
1. 在Simulink模型中设置初始条件：
   - 初始位置：x = 0
   - 初始角度：θ = 5° (0.0873 rad)
2. 参考位置设为0
3. 运行仿真10秒
4. 观察摆杆角度和小车位置

**预期结果**：
- 摆杆在2-3秒内稳定到竖直位置
- 最终角度偏差 < 2°
- 小车最终回到原点附近
- 最终位置偏差 < 0.1m

**性能指标**：

| 指标 | 要求 | 实测值 |
|------|------|--------|
| 调节时间 | < 5秒 |        |
| 角度稳态误差 | < 2° |        |
| 位置稳态误差 | < 0.1m |        |

**实际结果**：

| 测试日期 | 测试人 | 结果 | 备注 |
|---------|--------|------|------|
|         |        |      |      |

---

### TC-04: 位置跟踪测试（阶跃响应）

**测试目标**：验证小车能跟踪参考位置变化并保持摆杆平衡

**前置条件**：系统已稳定在初始状态

**测试步骤**：
1. 初始参考位置设为0
2. 启动仿真
3. 待系统稳定后，在Simulink中修改参考位置为5m
4. 观察系统响应

**预期结果**：
- 小车移动到目标位置（5m）
- 移动过程中摆杆角度偏差 < 15°
- 最终小车位置误差 < 0.05m
- 最终摆杆角度偏差 < 2°

**性能指标**：

| 指标 | 要求 | 实测值 |
|------|------|--------|
| 上升时间 | < 5秒 |        |
| 超调量 | < 25% |        |
| 调节时间 | < 8秒 |        |
| 稳态位置误差 | < 0.05m |        |

**测试数据**：
- 参考位置：0 → 5m
- 阶跃时刻：t = 2秒

**实际结果**：

| 测试日期 | 测试人 | 结果 | 备注 |
|---------|--------|------|------|
|         |        |      |      |

---

### TC-05: 滑块交互测试

**测试目标**：验证滑块控件能实时改变参考位置

**前置条件**：仿真运行中

**测试步骤**：
1. 拖动滑块到-5位置
2. 观察参考标记是否移动
3. 观察小车是否跟踪
4. 拖动滑块到+5位置
5. 重复观察

**预期结果**：
- 滑块值范围：-9 到 +9
- 参考标记实时跟随滑块移动
- 小车跟踪参考位置
- 摆杆保持平衡

**实际结果**：

| 测试日期 | 测试人 | 结果 | 备注 |
|---------|--------|------|------|
|         |        |      |      |

---

### TC-06: 回放功能测试

**测试目标**：验证动画回放功能

**前置条件**：仿真已完成

**测试步骤**：
1. 等待仿真结束
2. 检查工作区中是否存在变量t和y
3. 点击"Playback"按钮
4. 观察动画重放

**预期结果**：
- 仿真结束后"Playback"按钮变为可用
- 点击后动画从头开始播放
- 播放内容与原仿真一致
- 时间显示与仿真时间对应

**实际结果**：

| 测试日期 | 测试人 | 结果 | 备注 |
|---------|--------|------|------|
|         |        |      |      |

---

### TC-07: 数据记录测试

**测试目标**：验证仿真数据正确保存

**前置条件**：仿真已完成

**测试步骤**：
1. 仿真结束后检查工作区
2. 验证变量t存在且为时间向量
3. 验证变量y存在且为状态矩阵
4. 检查数据维度和范围

**预期结果**：
- 变量t为列向量，长度与仿真步数一致
- 变量y为矩阵，每行对应一个时刻的状态
- y的列数为3（参考位置、小车位置、摆杆角度）
- 数据无NaN或Inf

**验证代码**：
```matlab
assert(isvector(t), '时间不是向量');
assert(ismatrix(y), '状态不是矩阵');
assert(size(y,2) == 3, '状态维度错误');
assert(~any(isnan(y(:))), '数据包含NaN');
assert(~any(isinf(y(:))), '数据包含Inf');
```

**实际结果**：

| 测试日期 | 测试人 | 结果 | 备注 |
|---------|--------|------|------|
|         |        |      |      |

---

## 性能验证测试

### PV-01: 阶跃响应性能测试

**测试目标**：验证系统时域性能指标

**测试配置**：
- 初始状态：x=0, θ=0
- 参考位置：0 → 5m（t=1s时阶跃）
- 仿真时间：15秒

**性能指标要求**：

| 指标 | 规格要求 | 测试值 | 是否通过 |
|------|---------|--------|----------|
| 上升时间 | < 5秒 |        |          |
| 峰值时间 | < 8秒 |        |          |
| 超调量 | < 25% |        |          |
| 调节时间(2%误差带) | < 10秒 |        |          |
| 稳态位置误差 | < 0.05m |        |          |
| 稳态角度误差 | < 2° |        |          |

**数据分析**：

绘制响应曲线并标注性能指标：

```matlab
figure;
subplot(2,1,1);
plot(t, y(:,2)); % 小车位置
hold on;
plot(t, y(:,1), '--'); % 参考位置
xlabel('Time (s)');
ylabel('Position (m)');
legend('Actual', 'Reference');
title('Position Tracking');
grid on;

subplot(2,1,2);
plot(t, y(:,3)*180/pi); % 摆杆角度（转换为度）
xlabel('Time (s)');
ylabel('Angle (deg)');
title('Pendulum Angle');
grid on;
```

**实际结果**：

| 测试日期 | 测试人 | 结果 | 备注 |
|---------|--------|------|------|
|         |        |      |      |

---

### PV-02: 扰动抑制性能测试

**测试目标**：验证系统抗扰动能力

**测试配置**：
1. 系统先稳定在x=0位置
2. 在t=3s时施加5N脉冲扰动力，持续0.5秒
3. 观察系统恢复

**测试步骤**：
1. 在Simulink模型中添加扰动信号源
2. 配置脉冲参数：幅值5N，起始时间3s，宽度0.5s
3. 运行仿真
4. 记录最大偏差和恢复时间

**性能指标**：

| 指标 | 规格要求 | 测试值 | 是否通过 |
|------|---------|--------|----------|
| 最大位置偏差 | < 1m |        |          |
| 最大角度偏差 | < 20° |        |          |
| 恢复时间(回到±5%范围) | < 5秒 |        |          |

**实际结果**：

| 测试日期 | 测试人 | 结果 | 备注 |
|---------|--------|------|------|
|         |        |      |      |

---

### PV-03: 正弦跟踪性能测试

**测试目标**：验证系统动态跟踪能力

**测试配置**：
- 参考信号：`r(t) = 2*sin(0.5*2π*t)` m
- 频率：0.5 Hz
- 幅值：2 m
- 仿真时间：20秒

**性能指标**：

| 指标 | 规格要求 | 测试值 | 是否通过 |
|------|---------|--------|----------|
| 幅值衰减 | < 20% |        |          |
| 相位滞后 | < 30° |        |          |
| 最大角度偏差 | < 10° |        |          |

**数据分析**：

```matlab
% 计算幅值衰减和相位滞后
ref_signal = y(:,1);
actual_signal = y(:,2);

% FFT分析找到主频率分量
[pxx_ref, f] = pwelch(ref_signal, [], [], [], 1/mean(diff(t)));
[pxx_act, ~] = pwelch(actual_signal, [], [], [], 1/mean(diff(t)));

% 找到0.5Hz处的幅值
[~, idx] = min(abs(f - 0.5));
amplitude_ratio = sqrt(pxx_act(idx) / pxx_ref(idx));
```

**实际结果**：

| 测试日期 | 测试人 | 结果 | 备注 |
|---------|--------|------|------|
|         |        |      |      |

---

### PV-04: 大初始角度恢复测试

**测试目标**：验证控制器捕获范围

**测试配置**：
- 初始位置：x = 0
- 初始角度：θ = 15° (0.262 rad)
- 参考位置：0
- 仿真时间：10秒

**测试场景**：

| 场景 | 初始角度 | 预期结果 | 实测结果 | 通过 |
|------|---------|---------|---------|------|
| 1 | 5° | 成功稳定 |         |      |
| 2 | 10° | 成功稳定 |         |      |
| 3 | 15° | 成功稳定 |         |      |
| 4 | 20° | 可能失败 |         |      |
| 5 | 30° | 预期失败 |         |      |

**性能指标**：

| 指标 | 规格要求 | 测试值 |
|------|---------|--------|
| 最大允许初始角度 | > 15° |        |
| 从15°恢复时间 | < 5秒 |        |

**实际结果**：

| 测试日期 | 测试人 | 结果 | 备注 |
|---------|--------|------|------|
|         |        |      |      |

---

## 边界条件测试

### BC-01: 参数极值测试

**测试目标**：验证系统在极端参数下的行为

**测试场景**：

#### 场景1：极轻摆杆

| 参数 | 值 |
|------|-----|
| 小车质量M | 0.5 kg |
| 摆杆质量m | 0.05 kg（减小到1/4） |
| 摆杆长度L | 0.3 m |

**预期结果**：系统仍能稳定，但响应更快，可能需要调整控制参数

#### 场景2：极重摆杆

| 参数 | 值 |
|------|-----|
| 小车质量M | 0.5 kg |
| 摆杆质量m | 0.5 kg（增加到2.5倍） |
| 摆杆长度L | 0.3 m |

**预期结果**：系统响应变慢，可能需要更大的控制力

#### 场景3：极长摆杆

| 参数 | 值 |
|------|-----|
| 小车质量M | 0.5 kg |
| 摆杆质量m | 0.2 kg |
| 摆杆长度L | 0.6 m（增加到2倍） |

**预期结果**：更难控制，可能需要重新整定参数

**测试记录**：

| 场景 | 是否稳定 | 性能变化 | 备注 |
|------|---------|---------|------|
| 极轻摆杆 |         |         |      |
| 极重摆杆 |         |         |      |
| 极长摆杆 |         |         |      |

---

### BC-02: 快速参考变化测试

**测试目标**：验证系统对快速变化信号的响应

**测试配置**：
- 参考信号：方波，幅值±5m，周期4秒
- 仿真时间：20秒

**性能要求**：
- 每次阶跃后能跟踪到目标位置
- 摆杆角度偏差 < 20°
- 无失控现象

**实际结果**：

| 测试日期 | 测试人 | 结果 | 备注 |
|---------|--------|------|------|
|         |        |      |      |

---

### BC-03: 长时间运行测试

**测试目标**：验证系统数值稳定性

**测试配置**：
- 参考位置：正弦信号，幅值3m，频率0.2Hz
- 仿真时间：100秒

**验证项**：
- 无数值发散
- 无积分饱和导致的漂移
- 性能保持一致

**检查点**：

| 时间段 | 检查项 | 结果 |
|--------|--------|------|
| 0-20s | 正常运行 |      |
| 20-40s | 性能一致 |      |
| 40-60s | 无漂移 |      |
| 60-80s | 稳定性 |      |
| 80-100s | 最终状态 |      |

**实际结果**：

| 测试日期 | 测试人 | 结果 | 备注 |
|---------|--------|------|------|
|         |        |      |      |

---

## 鲁棒性测试

### RB-01: 传感器噪声测试

**测试目标**：验证系统抗噪声能力

**测试配置**：
1. 在位置测量上添加白噪声（功率0.01）
2. 在角度测量上添加白噪声（功率0.001）
3. 运行标准阶跃响应测试

**性能退化允许范围**：
- 超调量增加 < 10%
- 调节时间增加 < 30%
- 仍能稳定

**实际结果**：

| 测试日期 | 测试人 | 结果 | 备注 |
|---------|--------|------|------|
|         |        |      |      |

---

### RB-02: 参数摄动测试

**测试目标**：验证参数不确定性影响

**测试配置**：
在标称参数基础上进行±20%摄动

| 参数 | 标称值 | 测试值1(-20%) | 测试值2(+20%) | 结果1 | 结果2 |
|------|--------|---------------|---------------|-------|-------|
| M | 0.5 kg | 0.4 kg | 0.6 kg |       |       |
| m | 0.2 kg | 0.16 kg | 0.24 kg |       |       |
| L | 0.3 m | 0.24 m | 0.36 m |       |       |

**验证**：所有情况下系统仍能稳定

**实际结果**：

| 测试日期 | 测试人 | 结果 | 备注 |
|---------|--------|------|------|
|         |        |      |      |

---

## 测试工具脚本

### 自动化测试脚本

```matlab
%% 倒立摆系统自动化测试脚本
% 功能：批量运行测试用例并生成报告

clear; clc; close all;

%% 测试配置
test_results = struct();

%% TC-03: 平衡控制测试
fprintf('运行 TC-03: 平衡控制测试...\n');
try
    % 设置初始条件
    set_param('penddemo/Pendulum', 'x0', '0');
    set_param('penddemo/Pendulum', 'theta0', '0.0873'); % 5度
    
    % 运行仿真
    simOut = sim('penddemo', 'StopTime', '10');
    
    % 提取数据
    t = simOut.tout;
    x = simOut.yout{1}.Values.Data;
    theta = simOut.yout{2}.Values.Data;
    
    % 计算性能指标
    settling_time = calculateSettlingTime(t, theta, 0.02);
    steady_error_angle = abs(theta(end));
    steady_error_pos = abs(x(end));
    
    % 判断通过
    test_results.TC03.pass = (settling_time < 5) && ...
                              (steady_error_angle < 2*pi/180) && ...
                              (steady_error_pos < 0.1);
    test_results.TC03.settling_time = settling_time;
    test_results.TC03.steady_error_angle = steady_error_angle * 180/pi;
    test_results.TC03.steady_error_pos = steady_error_pos;
    
    fprintf('  调节时间: %.2f s\n', settling_time);
    fprintf('  角度误差: %.2f deg\n', steady_error_angle*180/pi);
    fprintf('  位置误差: %.3f m\n', steady_error_pos);
    fprintf('  结果: %s\n\n', test_results.TC03.pass ? 'PASS' : 'FAIL');
catch ME
    fprintf('  错误: %s\n\n', ME.message);
    test_results.TC03.pass = false;
end

%% TC-04: 位置跟踪测试
fprintf('运行 TC-04: 位置跟踪测试...\n');
try
    % 修改参考信号为阶跃
    % (需要在模型中配置)
    
    simOut = sim('penddemo', 'StopTime', '15');
    
    t = simOut.tout;
    x = simOut.yout{1}.Values.Data;
    ref = simOut.yout{3}.Values.Data;
    
    % 计算性能指标
    [overshoot, peak_time, rise_time] = calculateStepResponse(t, x, ref);
    settling_time = calculateSettlingTime(t, x-ref, 0.02);
    
    test_results.TC04.pass = (overshoot < 0.25) && ...
                              (settling_time < 8) && ...
                              (rise_time < 5);
    test_results.TC04.overshoot = overshoot;
    test_results.TC04.peak_time = peak_time;
    test_results.TC04.rise_time = rise_time;
    test_results.TC04.settling_time = settling_time;
    
    fprintf('  上升时间: %.2f s\n', rise_time);
    fprintf('  超调量: %.1f %%\n', overshoot*100);
    fprintf('  调节时间: %.2f s\n', settling_time);
    fprintf('  结果: %s\n\n', test_results.TC04.pass ? 'PASS' : 'FAIL');
catch ME
    fprintf('  错误: %s\n\n', ME.message);
    test_results.TC04.pass = false;
end

%% 生成测试报告
fprintf('========== 测试总结 ==========\n');
total_tests = 0;
passed_tests = 0;

fields = fieldnames(test_results);
for i = 1:length(fields)
    total_tests = total_tests + 1;
    if test_results.(fields{i}).pass
        passed_tests = passed_tests + 1;
        fprintf('%s: PASS\n', fields{i});
    else
        fprintf('%s: FAIL\n', fields{i});
    end
end

fprintf('\n通过率: %d/%d (%.1f%%)\n', ...
        passed_tests, total_tests, passed_tests/total_tests*100);

%% 辅助函数

function ts = calculateSettlingTime(t, signal, tolerance)
    % 计算调节时间（进入并保持在tolerance误差带的时间）
    final_value = signal(end);
    threshold = abs(final_value) * tolerance;
    
    % 从后往前找第一个超出误差带的点
    for i = length(signal):-1:1
        if abs(signal(i) - final_value) > threshold
            ts = t(i);
            return;
        end
    end
    ts = 0;
end

function [overshoot, peak_time, rise_time] = calculateStepResponse(t, signal, ref)
    % 计算阶跃响应指标
    
    % 找到阶跃发生时刻
    step_idx = find(diff(ref) > 0, 1);
    if isempty(step_idx)
        step_idx = 1;
    end
    
    final_value = ref(end);
    
    % 峰值和峰值时间
    [peak_value, peak_idx] = max(signal(step_idx:end));
    peak_idx = peak_idx + step_idx - 1;
    peak_time = t(peak_idx);
    
    % 超调量
    overshoot = (peak_value - final_value) / final_value;
    
    % 上升时间（10%-90%）
    v10 = final_value * 0.1;
    v90 = final_value * 0.9;
    
    idx10 = find(signal(step_idx:end) >= v10, 1) + step_idx - 1;
    idx90 = find(signal(step_idx:end) >= v90, 1) + step_idx - 1;
    
    rise_time = t(idx90) - t(idx10);
end
```

### 性能分析脚本

```matlab
%% 性能指标可视化脚本

% 加载仿真数据
load('simulation_results.mat'); % 假设数据已保存

figure('Position', [100 100 1200 800]);

% 子图1：位置跟踪
subplot(3,2,1);
plot(t, y(:,1), 'b--', 'LineWidth', 1.5); hold on;
plot(t, y(:,2), 'r-', 'LineWidth', 1.5);
xlabel('Time (s)');
ylabel('Position (m)');
legend('Reference', 'Actual');
title('Position Tracking');
grid on;

% 子图2：摆杆角度
subplot(3,2,2);
plot(t, y(:,3)*180/pi, 'b-', 'LineWidth', 1.5);
xlabel('Time (s)');
ylabel('Angle (deg)');
title('Pendulum Angle');
grid on;

% 子图3：位置误差
subplot(3,2,3);
error_pos = y(:,2) - y(:,1);
plot(t, error_pos, 'r-', 'LineWidth', 1.5);
xlabel('Time (s)');
ylabel('Error (m)');
title('Position Error');
grid on;

% 子图4：控制力（如果有）
subplot(3,2,4);
% plot(t, control_force, 'g-', 'LineWidth', 1.5);
% xlabel('Time (s)');
% ylabel('Force (N)');
% title('Control Force');
% grid on;

% 子图5：相平面图（位置-速度）
subplot(3,2,5);
velocity = gradient(y(:,2)) ./ gradient(t);
plot(y(:,2), velocity, 'b-', 'LineWidth', 1.5);
xlabel('Position (m)');
ylabel('Velocity (m/s)');
title('Phase Portrait (Position)');
grid on;

% 子图6：相平面图（角度-角速度）
subplot(3,2,6);
angular_velocity = gradient(y(:,3)) ./ gradient(t);
plot(y(:,3)*180/pi, angular_velocity*180/pi, 'r-', 'LineWidth', 1.5);
xlabel('Angle (deg)');
ylabel('Angular Velocity (deg/s)');
title('Phase Portrait (Angle)');
grid on;

sgtitle('System Performance Analysis');
```

## 测试记录表

### 总体测试记录

| 测试类别 | 测试用例 | 通过数 | 失败数 | 通过率 |
|---------|---------|--------|--------|--------|
| 功能测试 | 7 |        |        |        |
| 性能验证 | 4 |        |        |        |
| 边界测试 | 3 |        |        |        |
| 鲁棒性测试 | 2 |        |        |        |
| **总计** | **16** |        |        |        |

### 问题跟踪表

| 问题ID | 发现日期 | 描述 | 严重程度 | 状态 | 解决方案 |
|--------|---------|------|----------|------|----------|
|        |         |      |          |      |          |

## 测试结论

### 测试总结

（待填写）

### 发现的问题

（待填写）

### 改进建议

（待填写）

### 签署

| 角色 | 姓名 | 日期 | 签名 |
|------|------|------|------|
| 测试工程师 |      |      |      |
| 开发工程师 |      |      |      |
| 项目负责人 |      |      |      |

---

**文档版本**: 1.0  
**最后更新**: 2025-12-02
