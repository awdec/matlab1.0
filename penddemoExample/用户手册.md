# 一阶倒立摆控制系统用户手册

## 目录

1. [系统介绍](#系统介绍)
2. [安装与配置](#安装与配置)
3. [快速入门](#快速入门)
4. [界面说明](#界面说明)
5. [功能详解](#功能详解)
6. [参数配置](#参数配置)
7. [数据分析](#数据分析)
8. [常见问题](#常见问题)
9. [附录](#附录)

---

## 系统介绍

### 什么是倒立摆

倒立摆是经典的控制理论教学和研究案例，其特点是：
- **高度非线性**：系统动力学方程包含三角函数
- **自然不稳定**：摆杆竖直向上是不稳定平衡点
- **多变量耦合**：小车位置和摆杆角度相互影响

### 系统功能

本系统提供：
1. **物理建模**：基于拉格朗日方程的动力学模型
2. **控制设计**：PID控制器 + 状态观测器
3. **实时仿真**：Simulink数值求解
4. **动画展示**：可视化系统运行状态
5. **数据分析**：性能指标评估

### 应用场景

- 控制理论教学演示
- PID参数整定实验
- 控制算法性能对比
- 非线性系统仿真研究

---

## 安装与配置

### 系统要求

#### 软件要求

| 软件 | 最低版本 | 推荐版本 | 说明 |
|------|---------|---------|------|
| MATLAB | R2019a | R2023a | 核心平台 |
| Simulink | - | - | 必须安装 |
| Control System Toolbox | - | - | 推荐安装 |

#### 硬件要求

| 硬件 | 最低配置 | 推荐配置 |
|------|---------|---------|
| 处理器 | Intel i3 | Intel i5或更高 |
| 内存 | 4GB | 8GB或更高 |
| 硬盘空间 | 100MB | 500MB |
| 显示器分辨率 | 1280×720 | 1920×1080 |

### 安装步骤

#### 1. 获取项目文件

将项目文件夹解压到本地目录，例如：
```
C:\Users\YourName\Documents\MATLAB\penddemoExample\
```

#### 2. 验证文件完整性

确保包含以下文件：
- `penddemo.slx` - Simulink模型（必需）
- `pendan.m` - 动画S-Function（必需）
- `penddemoExample.m` - 主脚本（必需）
- `pendulum1.png` - 系统示意图（可选）
- `README.md` - 项目说明（可选）
- `参数整定指南.md` - 参数整定文档（可选）
- `测试验证文档.md` - 测试文档（可选）

#### 3. 添加到MATLAB路径

启动MATLAB后，在命令窗口执行：

```matlab
% 方法1：切换到项目目录
cd('C:\Users\YourName\Documents\MATLAB\penddemoExample');

% 方法2：添加到路径
addpath('C:\Users\YourName\Documents\MATLAB\penddemoExample');
savepath; % 永久保存路径
```

#### 4. 验证安装

运行测试命令：

```matlab
% 检查文件是否可访问
which penddemoExample
which pendan

% 尝试打开模型
open_system('penddemo');
```

如果没有错误信息，说明安装成功。

---

## 快速入门

### 5分钟快速体验

#### 步骤1：启动MATLAB

双击MATLAB图标，等待界面完全加载。

#### 步骤2：运行主脚本

在命令窗口输入：

```matlab
penddemoExample
```

按Enter键执行。

#### 步骤3：观察仿真

系统将自动：
1. 打开Simulink模型窗口
2. 设置仿真时间为10秒
3. 开始仿真
4. 弹出动画窗口

#### 步骤4：查看结果

- **动画窗口**：实时显示小车和摆杆运动
- **Scope窗口**：显示系统状态曲线
- **命令窗口**：仿真完成后显示变量

#### 步骤5：交互操作

仿真结束后：
1. 点击动画窗口的"Playback"按钮回放
2. 拖动滑块改变参考位置
3. 点击"Close"关闭动画窗口

---

## 界面说明

### Simulink模型窗口

打开`penddemo.slx`后，可以看到以下主要模块：

```
┌─────────────────────────────────────────┐
│  penddemo - Simulink Model              │
├─────────────────────────────────────────┤
│                                          │
│  [Reference] → [Controller] → [Pendulum]│
│                      ↑            ↓      │
│                [Observer]   [Animation] │
│                               [Scope]    │
│                                          │
└─────────────────────────────────────────┘
```

#### 主要模块

1. **Reference**（参考信号）
   - 类型：Constant或Signal Generator
   - 功能：设定小车期望位置
   - 可调参数：参考值

2. **Controller**（控制器）
   - 类型：子系统
   - 功能：计算控制力
   - 内部：双环PID控制器

3. **Pendulum**（倒立摆动力学）
   - 类型：掩码子系统
   - 功能：模拟倒立摆物理运动
   - 可调参数：质量、长度、重力等

4. **Observer**（状态观测器）
   - 类型：子系统
   - 功能：估计系统状态

5. **Animation**（动画模块）
   - 类型：S-Function
   - 功能：实时显示动画

6. **Scope**（示波器）
   - 类型：Sink
   - 功能：显示信号波形

### 动画窗口

动画窗口布局：

```
┌────────────────────────────────────────────┐
│ Pendulum Animation                     [×] │
├────────────────────────────────────────────┤
│                                             │
│              ┃                             │
│              ┃ ← 摆杆                      │
│    ┌─────────┴─────────┐                  │
│    │    小车           │                   │
│────┴──────────▼────────┴────────────────  │
│              ▼ ← 参考标记                  │
│                                             │
├────────────────────────────────────────────┤
│ [Playback] Time: 0.00      [━━━━━] [Close]│
│                    滑块（-9到+9）          │
└────────────────────────────────────────────┘
```

#### 界面元素

| 元素 | 说明 |
|------|------|
| 小车 | 矩形表示，宽度±2单位 |
| 摆杆 | 线段表示，长度10单位 |
| 参考标记 | 倒三角，指示期望位置 |
| 时间显示 | "Time: X.XX" 格式 |
| Playback按钮 | 仿真结束后可用 |
| 滑块 | 调整参考位置 |
| Close按钮 | 关闭窗口 |

### Scope示波器

Scope窗口显示多个信号：

```
┌─────────────────────────────────────┐
│ Scope                            [×]│
├─────────────────────────────────────┤
│ 位置 (m)                            │
│  10├─────────────────────          │
│    │         ╱───────              │
│   0├────────╱                      │
│    │                                │
│-10├────────────────────────        │
│    └────────────────────────────   │
│                                     │
│ 角度 (deg)                          │
│  30├─────────────────────          │
│    │   ╱╲                          │
│   0├──╱──╲──────────               │
│    │                                │
│-30├────────────────────────        │
│    └────────────────────────────   │
│    0        5        10       t(s) │
└─────────────────────────────────────┘
```

---

## 功能详解

### 基本仿真

#### 运行仿真

**方法1：使用脚本**

```matlab
penddemoExample
```

**方法2：在模型中运行**

1. 打开模型：`open_system('penddemo')`
2. 点击工具栏的"Run"按钮（绿色三角）
3. 或按快捷键：`Ctrl+T`

#### 停止仿真

- 点击工具栏的"Stop"按钮（红色方块）
- 或按快捷键：`Ctrl+T`

#### 暂停仿真

- 点击工具栏的"Pause"按钮
- 修改参数后可继续运行

### 参考位置控制

#### 设置恒定参考位置

1. 双击模型中的"Reference"模块
2. 修改"Constant value"参数
3. 示例：设为5表示小车移动到x=5m位置

```matlab
% 或使用命令
set_param('penddemo/Reference', 'Value', '5');
```

#### 设置阶跃参考信号

1. 用Step模块替换Constant模块
2. 设置参数：
   - Step time: 2（阶跃发生时刻）
   - Initial value: 0
   - Final value: 5

#### 设置正弦参考信号

1. 用Sine Wave模块替换Constant模块
2. 设置参数：
   - Amplitude: 3
   - Frequency: 0.5 (rad/s)
   - Phase: 0
   - Bias: 0

### 动画交互

#### 使用滑块

**功能**：实时改变参考位置

**操作**：
1. 确保仿真正在运行
2. 用鼠标拖动滑块
3. 小车将跟踪新的参考位置

**范围**：-9m 到 +9m

#### 回放动画

**前提**：仿真已完成，工作区存在变量t和y

**操作**：
1. 点击"Playback"按钮
2. 动画从头播放
3. 播放速度取决于仿真步长

**停止回放**：
- 等待播放完成
- 或关闭动画窗口

### 数据记录与导出

#### 自动记录（通过脚本）

运行`penddemoExample.m`后，工作区将包含：

```matlab
>> whos
  Name      Size         Bytes  Class     Attributes
  t         1001x1       8008   double    % 时间向量
  y         1001x3       24024  double    % 状态矩阵
```

- `t`：时间序列，从0到仿真停止时间
- `y`：状态数据，列分别为 [参考位置, 小车位置, 摆杆角度]

#### 保存数据

```matlab
% 保存到.mat文件
save('simulation_results.mat', 't', 'y');

% 导出到CSV
data_table = table(t, y(:,1), y(:,2), y(:,3), ...
    'VariableNames', {'Time', 'Reference', 'Position', 'Angle'});
writetable(data_table, 'simulation_results.csv');
```

#### 使用Simulation Data Inspector

1. 在Simulink模型中，右键信号线 → Log Signal
2. 运行仿真
3. 菜单：Simulation → Data Inspector
4. 查看、对比、导出数据

---

## 参数配置

### 物理参数配置

#### 访问掩码参数

1. 双击"Pendulum"子系统模块
2. 将打开掩码参数对话框
3. 修改以下参数：

| 参数名 | 符号 | 默认值 | 单位 | 说明 |
|--------|------|--------|------|------|
| Cart mass | M | 0.5 | kg | 小车质量 |
| Pendulum mass | m | 0.2 | kg | 摆杆质量 |
| Pendulum length | L | 0.3 | m | 到质心距离 |
| Gravity | g | 9.8 | m/s² | 重力加速度 |
| Friction | b | 0.1 | N·s/m | 摩擦系数 |

#### 通过命令修改

```matlab
% 获取掩码参数对象
mask = Simulink.Mask.get('penddemo/Pendulum');

% 修改参数
set_param('penddemo/Pendulum', 'M', '0.6');
set_param('penddemo/Pendulum', 'm', '0.25');
set_param('penddemo/Pendulum', 'L', '0.4');
```

### 控制器参数配置

#### 双环PID参数

控制器包含两个PID控制器：

**外环（位置控制）**

```matlab
% 在Controller子系统中找到外环PID模块
Kp_outer = 10;  % 比例增益
Ki_outer = 0.5; % 积分增益
Kd_outer = 5;   % 微分增益

set_param('penddemo/Controller/PID_Outer', ...
    'P', num2str(Kp_outer), ...
    'I', num2str(Ki_outer), ...
    'D', num2str(Kd_outer));
```

**内环（角度控制）**

```matlab
Kp_inner = 30;
Ki_inner = 2;
Kd_inner = 10;

set_param('penddemo/Controller/PID_Inner', ...
    'P', num2str(Kp_inner), ...
    'I', num2str(Ki_inner), ...
    'D', num2str(Kd_inner));
```

详细整定方法参见《参数整定指南.md》

### 仿真参数配置

#### 仿真时间

```matlab
% 设置停止时间（秒）
set_param('penddemo', 'StopTime', '20');
```

#### 求解器配置

```matlab
% 打开配置参数
set_param('penddemo', 'SolverType', 'Variable-step');
set_param('penddemo', 'Solver', 'ode45'); % Dormand-Prince

% 设置精度
set_param('penddemo', 'RelTol', '1e-3');
set_param('penddemo', 'AbsTol', 'auto');

% 设置最大步长
set_param('penddemo', 'MaxStep', '0.01');
```

可选求解器：
- `ode45`：中等精度，通用（推荐）
- `ode23`：低精度，快速
- `ode15s`：刚性系统

### 初始条件设置

```matlab
% 在Pendulum子系统中设置
set_param('penddemo/Pendulum', 'x0', '0');       % 初始位置
set_param('penddemo/Pendulum', 'x_dot0', '0');   % 初始速度
set_param('penddemo/Pendulum', 'theta0', '0.1'); % 初始角度(rad)
set_param('penddemo/Pendulum', 'theta_dot0', '0'); % 初始角速度
```

---

## 数据分析

### 绘制响应曲线

#### 基本曲线

```matlab
% 确保数据已加载
figure;

% 位置跟踪
subplot(2,1,1);
plot(t, y(:,1), 'b--', 'LineWidth', 1.5, 'DisplayName', 'Reference');
hold on;
plot(t, y(:,2), 'r-', 'LineWidth', 1.5, 'DisplayName', 'Actual');
xlabel('Time (s)');
ylabel('Position (m)');
legend('Location', 'best');
title('Cart Position Tracking');
grid on;

% 摆杆角度
subplot(2,1,2);
plot(t, y(:,3)*180/pi, 'b-', 'LineWidth', 1.5);
xlabel('Time (s)');
ylabel('Angle (deg)');
title('Pendulum Angle');
grid on;
```

#### 误差曲线

```matlab
figure;

% 位置误差
subplot(2,1,1);
error_pos = y(:,2) - y(:,1);
plot(t, error_pos, 'r-', 'LineWidth', 1.5);
xlabel('Time (s)');
ylabel('Position Error (m)');
title('Tracking Error');
grid on;

% 角度偏差
subplot(2,1,2);
plot(t, y(:,3)*180/pi, 'b-', 'LineWidth', 1.5);
yline(5, 'r--', 'Upper Limit');
yline(-5, 'r--', 'Lower Limit');
xlabel('Time (s)');
ylabel('Angle (deg)');
title('Angle Deviation');
grid on;
```

### 性能指标计算

#### 上升时间

```matlab
function tr = riseTime(t, signal, target)
    % 计算从10%到90%的时间
    v10 = target * 0.1;
    v90 = target * 0.9;
    
    idx10 = find(signal >= v10, 1);
    idx90 = find(signal >= v90, 1);
    
    if ~isempty(idx10) && ~isempty(idx90)
        tr = t(idx90) - t(idx10);
    else
        tr = NaN;
    end
end

% 使用示例
target_position = y(end, 1);
tr = riseTime(t, y(:,2), target_position);
fprintf('上升时间: %.2f 秒\n', tr);
```

#### 超调量

```matlab
function Mp = overshoot(signal, target)
    % 计算超调量百分比
    peak = max(signal);
    Mp = (peak - target) / target * 100;
end

% 使用示例
Mp = overshoot(y(:,2), y(end,1));
fprintf('超调量: %.1f%%\n', Mp);
```

#### 调节时间

```matlab
function ts = settlingTime(t, signal, target, tolerance)
    % 计算进入±tolerance%误差带的时间
    if nargin < 4
        tolerance = 0.02; % 默认2%
    end
    
    threshold = abs(target) * tolerance;
    
    % 从后往前找第一个超出误差带的点
    for i = length(signal):-1:1
        if abs(signal(i) - target) > threshold
            ts = t(i);
            return;
        end
    end
    ts = t(1);
end

% 使用示例
ts = settlingTime(t, y(:,2), y(end,1), 0.02);
fprintf('调节时间(2%%): %.2f 秒\n', ts);
```

#### 稳态误差

```matlab
function ess = steadyStateError(signal, target)
    % 计算稳态误差（取最后10%数据的平均值）
    n = length(signal);
    n_avg = floor(n * 0.1);
    avg_final = mean(signal(end-n_avg:end));
    ess = abs(avg_final - target);
end

% 使用示例
ess = steadyStateError(y(:,2), y(end,1));
fprintf('稳态误差: %.4f m\n', ess);
```

### 完整性能报告

```matlab
function report = generatePerformanceReport(t, y)
    % 生成完整性能报告
    
    report = struct();
    
    % 位置跟踪性能
    target_pos = y(end, 1);
    report.position.rise_time = riseTime(t, y(:,2), target_pos);
    report.position.overshoot = overshoot(y(:,2), target_pos);
    report.position.settling_time = settlingTime(t, y(:,2), target_pos);
    report.position.steady_error = steadyStateError(y(:,2), target_pos);
    
    % 角度稳定性能
    report.angle.max_deviation = max(abs(y(:,3))) * 180/pi;
    report.angle.final_error = abs(y(end,3)) * 180/pi;
    
    % 显示报告
    fprintf('========== 性能报告 ==========\n');
    fprintf('位置跟踪:\n');
    fprintf('  上升时间: %.2f s\n', report.position.rise_time);
    fprintf('  超调量: %.1f%%\n', report.position.overshoot);
    fprintf('  调节时间: %.2f s\n', report.position.settling_time);
    fprintf('  稳态误差: %.4f m\n', report.position.steady_error);
    fprintf('\n角度稳定:\n');
    fprintf('  最大偏差: %.2f deg\n', report.angle.max_deviation);
    fprintf('  最终误差: %.2f deg\n', report.angle.final_error);
    fprintf('=============================\n');
end

% 使用示例
report = generatePerformanceReport(t, y);
```

### 相平面图

```matlab
% 位置相平面
figure;
subplot(1,2,1);
vel = gradient(y(:,2)) ./ gradient(t);
plot(y(:,2), vel, 'b-', 'LineWidth', 1.5);
xlabel('Position (m)');
ylabel('Velocity (m/s)');
title('Position Phase Portrait');
grid on;

% 角度相平面
subplot(1,2,2);
ang_vel = gradient(y(:,3)) ./ gradient(t);
plot(y(:,3)*180/pi, ang_vel*180/pi, 'r-', 'LineWidth', 1.5);
xlabel('Angle (deg)');
ylabel('Angular Velocity (deg/s)');
title('Angle Phase Portrait');
grid on;
```

---

## 常见问题

### Q1: 动画窗口没有出现

**可能原因**：
1. S-Function文件`pendan.m`不在路径中
2. 模型配置错误

**解决方法**：
```matlab
% 检查文件路径
which pendan

% 如果返回空，添加路径
addpath('penddemoExample路径');

% 重新运行
penddemoExample
```

### Q2: 摆杆持续振荡不稳定

**可能原因**：PID参数设置不当

**解决方法**：
1. 减小积分增益Ki
2. 增大微分增益Kd
3. 参考《参数整定指南.md》重新整定

### Q3: 小车位置漂移

**可能原因**：积分饱和

**解决方法**：
1. 在PID模块中启用Anti-windup
2. 设置积分限幅
3. 减小积分增益

### Q4: 仿真运行缓慢

**可能原因**：求解器步长过小

**解决方法**：
```matlab
% 增大最大步长
set_param('penddemo', 'MaxStep', '0.05');

% 或使用更快的求解器
set_param('penddemo', 'Solver', 'ode23');
```

### Q5: 数值溢出错误

**可能原因**：
1. 初始条件设置过大
2. PID参数过大导致控制力饱和

**解决方法**：
1. 检查初始角度是否在合理范围（< 20°）
2. 检查PID参数是否过大
3. 添加控制力限幅

### Q6: 回放功能不可用

**可能原因**：工作区没有数据

**解决方法**：
```matlab
% 检查变量是否存在
whos t y

% 如果不存在，重新运行仿真
penddemoExample

% 确保脚本包含数据保存代码
```

### Q7: 模型无法打开

**可能原因**：MATLAB版本不兼容

**解决方法**：
1. 检查MATLAB版本（需R2019a或更高）
2. 使用较新版本保存的模型需要降级
3. 或升级MATLAB

### Q8: 参数修改后无效

**可能原因**：
1. 没有保存修改
2. 使用了旧的模型数据

**解决方法**：
```matlab
% 关闭并重新打开模型
close_system('penddemo', 0);
open_system('penddemo');

% 或清空缓存
Simulink.sdi.clear
```

---

## 附录

### 附录A：快捷键参考

| 功能 | 快捷键 |
|------|--------|
| 运行仿真 | Ctrl+T |
| 停止仿真 | Ctrl+T（运行时） |
| 打开模型 | Ctrl+O |
| 保存模型 | Ctrl+S |
| 查找模块 | Ctrl+F |
| 缩放视图 | Ctrl+滚轮 |
| 全屏显示 | Ctrl+Shift+T |

### 附录B：命令速查

```matlab
% 模型操作
open_system('penddemo');           % 打开模型
close_system('penddemo');          % 关闭模型
save_system('penddemo');           % 保存模型
sim('penddemo');                   % 运行仿真

% 参数设置
set_param('penddemo', 'StopTime', '10');  % 设置仿真时间
get_param('penddemo', 'StopTime');        % 获取参数

% 路径管理
addpath('路径');                    % 添加路径
rmpath('路径');                     % 移除路径
savepath;                          % 保存路径

% 数据操作
save('file.mat', 't', 'y');        % 保存数据
load('file.mat');                  % 加载数据
clear;                             % 清空变量
clc;                               % 清空命令窗口
```

### 附录C：文件结构

```
penddemoExample/
├── penddemo.slx              # Simulink主模型
├── pendan.m                  # 动画S-Function
├── penddemoExample.m         # 主运行脚本
├── pendulum1.png             # 系统示意图
├── README.md                 # 项目说明
├── 用户手册.md               # 本文档
├── 参数整定指南.md           # PID整定方法
└── 测试验证文档.md           # 测试用例
```

### 附录D：技术支持

**官方资源**：
- MathWorks文档中心：https://www.mathworks.com/help/
- Simulink示例：https://www.mathworks.com/help/simulink/examples.html
- MATLAB Central：https://www.mathworks.com/matlabcentral/

**推荐学习资源**：
- 《MATLAB/Simulink系统仿真》教材
- 《自动控制原理》- 倒立摆案例
- MathWorks在线培训课程

### 附录E：版本历史

| 版本 | 日期 | 修改内容 |
|------|------|----------|
| 1.0 | 2023 | 初始版本，基于MathWorks示例 |
| 1.1 | 2025 | 添加详细文档和测试用例 |

---

**文档版本**: 1.1  
**最后更新**: 2025-12-02  
**作者**: 系统开发团队

---

## 结语

本用户手册旨在帮助您快速上手一阶倒立摆控制系统。如果遇到手册未涵盖的问题，请参考其他配套文档或联系技术支持。

祝您使用愉快！
