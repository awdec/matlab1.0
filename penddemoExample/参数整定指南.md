# PID控制器参数整定指南

## 概述

本文档详细介绍一阶倒立摆系统PID控制器的参数整定方法，包括理论基础、整定步骤和调试技巧。

## PID控制原理

### 控制律

PID控制器的输出为：

```
u(t) = Kp·e(t) + Ki·∫e(t)dt + Kd·de(t)/dt
```

其中：
- `u(t)` - 控制输出（控制力）
- `e(t)` - 误差信号（期望值 - 实际值）
- `Kp` - 比例增益
- `Ki` - 积分增益
- `Kd` - 微分增益

### 各项作用

| 控制项 | 作用机理 | 优点 | 缺点 |
|--------|----------|------|------|
| 比例(P) | 按当前偏差大小产生控制作用 | 响应快速 | 存在稳态误差 |
| 积分(I) | 累积历史误差 | 消除稳态误差 | 可能引起超调和振荡 |
| 微分(D) | 根据误差变化趋势提前调节 | 改善动态性能，减小超调 | 对噪声敏感 |

## 双环控制结构

倒立摆系统采用级联双环控制：

```
参考位置 → 外环PID → 角度参考 → 内环PID → 控制力
              ↑                        ↑
          实际位置                  实际角度
```

### 外环（位置控制）

- **目标**：使小车位置跟踪参考信号
- **输入**：位置误差 = 参考位置 - 实际位置
- **输出**：期望摆杆角度

### 内环（姿态控制）

- **目标**：快速稳定摆杆角度
- **输入**：角度误差 = 期望角度 - 实际角度
- **输出**：施加在小车上的控制力

## 参数整定方法

### 方法一：试凑法（推荐初学者）

#### 步骤1：纯比例控制（P控制）

1. 将Ki和Kd设为0
2. 从小的Kp值开始（如Kp=1）
3. 逐步增大Kp，观察响应
4. 记录临界增益Kc（系统开始持续振荡时的Kp值）

**现象观察**：
- Kp过小：响应缓慢，稳态误差大
- Kp适中：响应较快，有一定超调
- Kp过大：系统振荡或不稳定

#### 步骤2：添加微分控制（PD控制）

1. 保持Kp为0.6×Kc
2. 逐步增大Kd（从0开始）
3. 观察超调量减小、振荡抑制

**调节建议**：
- 超调大 → 增大Kd
- 响应过于缓慢 → 减小Kd
- 典型值：Kd = 0.1~0.3

#### 步骤3：引入积分控制（PID控制）

1. 在PD基础上逐步增大Ki
2. 从很小的值开始（如Ki=0.01）
3. 观察稳态误差消除情况

**调节建议**：
- 稳态误差大 → 增大Ki
- 出现超调或振荡 → 减小Ki
- 典型值：Ki = 0.01~0.1

### 方法二：Ziegler-Nichols法

#### 第一步：确定临界参数

1. 设置Ki=0, Kd=0
2. 逐步增大Kp直到系统持续振荡
3. 记录临界增益Kc和振荡周期Tc

#### 第二步：计算PID参数

根据经验公式：

| 控制器类型 | Kp | Ki | Kd |
|-----------|----|----|-----|
| P控制 | 0.5·Kc | - | - |
| PI控制 | 0.45·Kc | 1.2·Kp/Tc | - |
| PID控制 | 0.6·Kc | 2·Kp/Tc | Kp·Tc/8 |

#### 第三步：微调优化

在初值基础上根据实际性能微调。

### 方法三：自动整定（使用MATLAB工具）

#### 使用PID Tuner

1. 在Simulink模型中双击PID Controller模块
2. 点击"Tune"按钮打开PID Tuner
3. 设置性能指标：
   - Response time（响应时间）
   - Transient behavior（瞬态行为）
   - Robustness（鲁棒性）
4. 点击"Update Block"应用参数

#### 使用命令行自动整定

```matlab
% 获取系统传递函数
sys = tf(num, den);

% 自动设计PID控制器
C = pidtune(sys, 'PID');

% 查看参数
Kp = C.Kp;
Ki = C.Ki;
Kd = C.Kd;
```

## 双环系统整定策略

### 内环优先原则

1. **先整定内环（角度控制）**
   - 内环负责快速稳定摆杆
   - 必须先保证内环稳定
   - 内环带宽应比外环高2-5倍

2. **后整定外环（位置控制）**
   - 固定内环参数
   - 把内环视为已稳定的被控对象
   - 整定外环PID参数

### 具体步骤

#### 阶段1：内环整定

1. 断开外环，给定恒定的小角度参考（如5°）
2. 采用试凑法或Z-N法整定内环PID
3. 验证指标：
   - 调节时间 < 2秒
   - 超调量 < 15%
   - 稳态误差 < 1°

#### 阶段2：外环整定

1. 闭合内环，给定位置阶跃信号
2. 整定外环PID参数
3. 验证指标：
   - 调节时间 < 5秒
   - 超调量 < 25%
   - 稳态误差 < 0.05m

## 参数影响规律总结

### 对系统性能的影响

| 参数增大 | 上升时间 | 超调量 | 稳态误差 | 稳定性 |
|---------|---------|--------|---------|--------|
| Kp增大 | 减小 | 增大 | 减小 | 变差 |
| Ki增大 | 减小 | 增大 | 消除 | 变差 |
| Kd增大 | 变化小 | 减小 | 无影响 | 改善 |

### 典型问题及调整方向

| 现象 | 可能原因 | 调整方向 |
|------|---------|---------|
| 响应缓慢 | Kp过小 | 增大Kp |
| 超调过大 | Kp或Ki过大 | 减小Kp或Ki，增大Kd |
| 持续振荡 | Ki过大或Kd过小 | 减小Ki，增大Kd |
| 稳态误差大 | Ki过小或无积分项 | 增大Ki |
| 高频震颤 | Kd过大 | 减小Kd或增加滤波 |

## 推荐参数范围

基于标准物理参数（M=0.5kg, m=0.2kg, L=0.3m）：

### 内环（角度控制）

```
Kp_inner: 20 ~ 50
Ki_inner: 0 ~ 5
Kd_inner: 5 ~ 15
```

### 外环（位置控制）

```
Kp_outer: 5 ~ 15
Ki_outer: 0.1 ~ 1
Kd_outer: 2 ~ 8
```

**注意**：这些值仅供参考，实际参数需要根据具体系统调整。

## 高级整定技巧

### 1. 积分抗饱和

当控制输出达到饱和时，停止积分累积：

```matlab
if abs(u) < u_max
    integral = integral + error * dt;
end
```

在Simulink中使用PID Controller模块的Anti-windup选项。

### 2. 微分滤波

抑制高频噪声对微分项的影响：

```
滤波微分 = N/(1+N/s) × s × e(s)
```

其中N为滤波系数，典型值为5-20。

### 3. 增益调度

根据工作点动态调整PID参数：

```matlab
if abs(theta) > 10*pi/180  % 大角度
    Kp = Kp_large;
else  % 小角度
    Kp = Kp_small;
end
```

### 4. 前馈补偿

对已知扰动或参考信号变化进行前馈：

```
控制输出 = PID输出 + 前馈项
```

## 验证测试

### 测试1：阶跃响应

**输入**：参考位置从0跳变到5m

**观察**：
- 上升时间
- 峰值时间
- 超调量
- 调节时间
- 稳态误差

### 测试2：扰动抑制

**输入**：在稳定状态下施加脉冲扰动力（如5N持续0.5秒）

**观察**：
- 最大偏差
- 恢复时间

### 测试3：正弦跟踪

**输入**：正弦参考信号（幅值2m，频率0.5Hz）

**观察**：
- 幅值衰减
- 相位滞后

### 测试4：初值响应

**输入**：非零初始角度（如15°），参考位置为0

**观察**：
- 收敛速度
- 控制平稳性

## 调试流程图

```
开始
  ↓
设置所有参数为0
  ↓
增大Kp直到系统响应
  ↓
继续增大Kp直到轻微振荡
  ↓
记录Kc，减小Kp到0.6·Kc
  ↓
增大Kd抑制超调
  ↓
是否满足动态性能? → 否 → 微调Kp和Kd
  ↓ 是
增大Ki消除稳态误差
  ↓
是否出现振荡? → 是 → 减小Ki
  ↓ 否
最终参数验证
  ↓
完成
```

## MATLAB调试代码示例

```matlab
% 参数扫描脚本
Kp_range = 10:5:50;
results = [];

for Kp = Kp_range
    % 设置参数
    set_param('penddemo/Controller/Kp', 'Value', num2str(Kp));
    
    % 运行仿真
    simOut = sim('penddemo', 'StopTime', '10');
    
    % 提取性能指标
    settling_time = calculateSettlingTime(simOut);
    overshoot = calculateOvershoot(simOut);
    
    % 保存结果
    results = [results; Kp, settling_time, overshoot];
end

% 绘制性能曲线
figure;
subplot(2,1,1);
plot(results(:,1), results(:,2));
xlabel('Kp'); ylabel('Settling Time (s)');

subplot(2,1,2);
plot(results(:,1), results(:,3));
xlabel('Kp'); ylabel('Overshoot (%)');
```

## 常见错误及解决

### 错误1：参数设置后系统立即发散

**原因**：Kp或Ki设置过大

**解决**：减小参数到安全范围，从小值开始逐步增大

### 错误2：积分项导致大幅超调

**原因**：积分累积过快

**解决**：
1. 减小Ki值
2. 启用积分抗饱和
3. 设置积分限幅

### 错误3：微分项引起高频震颤

**原因**：Kd过大或传感器噪声

**解决**：
1. 减小Kd
2. 增大微分滤波系数N
3. 对测量信号进行滤波

## 参考资料

1. Ziegler, J.G. and Nichols, N.B. (1942), "Optimum Settings for Automatic Controllers"
2. Åström, K.J. and Hägglund, T. (1995), "PID Controllers: Theory, Design, and Tuning"
3. MATLAB Documentation: "PID Controller Tuning"
4. Franklin, G.F., Powell, J.D., and Emami-Naeini, A., "Feedback Control of Dynamic Systems"

## 总结

PID参数整定是一个迭代过程，需要：

1. **理解系统**：掌握被控对象特性
2. **选择方法**：根据经验和工具选择整定方法
3. **耐心调试**：逐步调整，观察响应
4. **验证测试**：在多种工况下验证性能
5. **文档记录**：记录最终参数和整定过程

成功的参数整定需要理论知识和实践经验的结合。
